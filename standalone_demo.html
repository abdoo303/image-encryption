<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hyperchaotic Cryptography System</title>
    
    <!-- React and Babel -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Courier New', monospace;
            overflow-x: hidden;
        }
        
        #root {
            min-height: 100vh;
        }
    </style>
</head>
<body>
    <div id="root"></div>
    
    <script type="text/babel">
        const { useState, useEffect, useRef } = React;
        
        // Import icons from Lucide
        const Upload = () => <i data-lucide="upload"></i>;
        const Lock = () => <i data-lucide="lock"></i>;
        const Unlock = () => <i data-lucide="unlock"></i>;
        const Activity = () => <i data-lucide="activity"></i>;
        const Code = () => <i data-lucide="code"></i>;
        
        // Initialize Lucide icons after component renders
        useEffect(() => {
            if (window.lucide) {
                window.lucide.createIcons();
            }
        }, []);
        
        function ChaoticCryptoApp() {
            const [initialized, setInitialized] = useState(false);
            const [loading, setLoading] = useState(false);
            const [seed, setSeed] = useState('quantum_entropy_2025');
            const [systemInfo, setSystemInfo] = useState(null);
            const [originalImage, setOriginalImage] = useState(null);
            const [encryptedImage, setEncryptedImage] = useState(null);
            const [decryptedImage, setDecryptedImage] = useState(null);
            const [rounds, setRounds] = useState(3);
            const [activeTab, setActiveTab] = useState('encrypt');
            const [visualData, setVisualData] = useState(null);
            const [error, setError] = useState('');
            const canvasRef = useRef(null);
            
            useEffect(() => {
                if (window.lucide) {
                    window.lucide.createIcons();
                }
            });
            
            const initializeSystem = async () => {
                setLoading(true);
                setError('');
                try {
                    const response = await fetch('http://localhost:5000/api/initialize', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ seed })
                    });
                    const data = await response.json();
                    
                    if (data.success) {
                        setSystemInfo(data);
                        setInitialized(true);
                        
                        const vizResponse = await fetch('http://localhost:5000/api/visualize');
                        const vizData = await vizResponse.json();
                        if (vizData.success) {
                            setVisualData(vizData.trajectories);
                        }
                    }
                } catch (error) {
                    console.error('Initialization error:', error);
                    setError('Failed to initialize. Make sure Flask server is running on port 5000.');
                }
                setLoading(false);
            };
            
            const handleImageUpload = (e) => {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = (event) => {
                        setOriginalImage(event.target.result);
                        setEncryptedImage(null);
                        setDecryptedImage(null);
                    };
                    reader.readAsDataURL(file);
                }
            };
            
            const encryptImage = async () => {
                if (!originalImage) return;
                setLoading(true);
                setError('');
                try {
                    const response = await fetch('http://localhost:5000/api/encrypt', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ image: originalImage, rounds })
                    });
                    const data = await response.json();
                    if (data.success) {
                        setEncryptedImage(data.encrypted_image);
                    }
                } catch (error) {
                    console.error('Encryption error:', error);
                    setError('Encryption failed');
                }
                setLoading(false);
            };
            
            const decryptImage = async () => {
                if (!encryptedImage || !systemInfo) return;
                setLoading(true);
                setError('');
                try {
                    const response = await fetch('http://localhost:5000/api/decrypt', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ 
                            encrypted_image: encryptedImage,
                            original_shape: [100, 100, 3],
                            rounds 
                        })
                    });
                    const data = await response.json();
                    if (data.success) {
                        setDecryptedImage(data.decrypted_image);
                    }
                } catch (error) {
                    console.error('Decryption error:', error);
                    setError('Decryption failed');
                }
                setLoading(false);
            };
            
            useEffect(() => {
                if (!visualData || !canvasRef.current) return;
                
                const canvas = canvasRef.current;
                const ctx = canvas.getContext('2d');
                const width = canvas.width;
                const height = canvas.height;
                
                ctx.fillStyle = '#000000';
                ctx.fillRect(0, 0, width, height);
                
                const systems = [
                    { data: visualData.system1, color: '#00ffff' },
                    { data: visualData.system2, color: '#ff00ff' },
                    { data: visualData.system3, color: '#ffff00' }
                ];
                
                systems.forEach(system => {
                    const x = system.data.x;
                    const y = system.data.y;
                    
                    const xMin = Math.min(...x);
                    const xMax = Math.max(...x);
                    const yMin = Math.min(...y);
                    const yMax = Math.max(...y);
                    
                    ctx.strokeStyle = system.color;
                    ctx.lineWidth = 1;
                    ctx.globalAlpha = 0.3;
                    ctx.beginPath();
                    
                    for (let i = 0; i < x.length; i++) {
                        const px = ((x[i] - xMin) / (xMax - xMin)) * (width - 40) + 20;
                        const py = ((y[i] - yMin) / (yMax - yMin)) * (height - 40) + 20;
                        
                        if (i === 0) {
                            ctx.moveTo(px, py);
                        } else {
                            ctx.lineTo(px, py);
                        }
                    }
                    ctx.stroke();
                });
            }, [visualData]);
            
            return (
                <div style={{
                    minHeight: '100vh',
                    background: 'linear-gradient(135deg, #0a0a0a 0%, #1a0a1a 50%, #0a1a1a 100%)',
                    color: '#ffffff',
                    position: 'relative',
                    overflow: 'hidden'
                }}>
                    <style>{`
                        @keyframes gridMove {
                            0% { transform: translate(0, 0); }
                            100% { transform: translate(50px, 50px); }
                        }
                        @keyframes glitch {
                            0% { transform: translate(0); }
                            20% { transform: translate(-2px, 2px); }
                            40% { transform: translate(-2px, -2px); }
                            60% { transform: translate(2px, 2px); }
                            80% { transform: translate(2px, -2px); }
                            100% { transform: translate(0); }
                        }
                        .cyber-button {
                            background: linear-gradient(135deg, rgba(0, 255, 255, 0.2), rgba(255, 0, 255, 0.2));
                            border: 2px solid;
                            padding: 12px 24px;
                            cursor: pointer;
                            transition: all 0.3s ease;
                            position: relative;
                            overflow: hidden;
                        }
                        .cyber-button:hover {
                            box-shadow: 0 0 20px rgba(0, 255, 255, 0.5);
                            transform: translateY(-2px);
                        }
                    `}</style>
                    
                    <div style={{
                        position: 'fixed',
                        top: 0,
                        left: 0,
                        right: 0,
                        bottom: 0,
                        backgroundImage: 'linear-gradient(rgba(0, 255, 255, 0.03) 1px, transparent 1px), linear-gradient(90deg, rgba(255, 0, 255, 0.03) 1px, transparent 1px)',
                        backgroundSize: '50px 50px',
                        animation: 'gridMove 20s linear infinite',
                        pointerEvents: 'none',
                        zIndex: 0
                    }} />
                    
                    <div style={{ position: 'relative', zIndex: 1, padding: '40px 20px' }}>
                        <header style={{ textAlign: 'center', marginBottom: '60px' }}>
                            <h1 style={{
                                fontSize: '4rem',
                                fontWeight: 'bold',
                                letterSpacing: '0.1em',
                                marginBottom: '10px',
                                background: 'linear-gradient(135deg, #00ffff, #ff00ff, #ffff00)',
                                WebkitBackgroundClip: 'text',
                                WebkitTextFillColor: 'transparent',
                                animation: 'glitch 5s infinite'
                            }}>
                                HYPERCHAOS
                            </h1>
                            <p style={{
                                fontSize: '1.2rem',
                                color: '#00ffff',
                                letterSpacing: '0.3em',
                                opacity: 0.8
                            }}>
                                {'>'} QUANTUM ENCRYPTION PROTOCOL {'<'}
                            </p>
                        </header>
                        
                        {error && (
                            <div style={{
                                maxWidth: '800px',
                                margin: '0 auto 20px',
                                padding: '15px',
                                background: 'rgba(255, 0, 0, 0.2)',
                                border: '1px solid #ff0000',
                                color: '#ff6666',
                                textAlign: 'center'
                            }}>
                                {error}
                            </div>
                        )}
                        
                        {!initialized && (
                            <div style={{
                                maxWidth: '600px',
                                margin: '0 auto',
                                padding: '40px',
                                background: 'rgba(0, 0, 0, 0.6)',
                                border: '2px solid #00ffff',
                                boxShadow: '0 0 30px rgba(0, 255, 255, 0.3)',
                                backdropFilter: 'blur(10px)'
                            }}>
                                <h2 style={{ color: '#00ffff', marginBottom: '20px' }}>
                                    {'[ SYSTEM INITIALIZATION ]'}
                                </h2>
                                <div style={{ marginBottom: '20px' }}>
                                    <label style={{ display: 'block', marginBottom: '10px', color: '#00ffff' }}>
                                        ENTROPY SEED:
                                    </label>
                                    <input
                                        type="text"
                                        value={seed}
                                        onChange={(e) => setSeed(e.target.value)}
                                        style={{
                                            width: '100%',
                                            padding: '12px',
                                            background: 'rgba(0, 0, 0, 0.8)',
                                            border: '1px solid #00ffff',
                                            color: '#00ffff',
                                            fontFamily: '"Courier New", monospace'
                                        }}
                                    />
                                </div>
                                <button
                                    onClick={initializeSystem}
                                    disabled={loading}
                                    className="cyber-button"
                                    style={{
                                        width: '100%',
                                        color: '#00ffff',
                                        borderColor: '#00ffff',
                                        fontSize: '1.1rem',
                                        fontWeight: 'bold',
                                        letterSpacing: '0.2em'
                                    }}
                                >
                                    {loading ? '[ INITIALIZING... ]' : '[ INITIALIZE SYSTEMS ]'}
                                </button>
                                <p style={{
                                    marginTop: '20px',
                                    fontSize: '0.85rem',
                                    color: '#888',
                                    textAlign: 'center'
                                }}>
                                    Make sure Flask server is running on port 5000
                                </p>
                            </div>
                        )}
                        
                        {initialized && (
                            <div style={{ maxWidth: '1200px', margin: '0 auto' }}>
                                <p style={{ textAlign: 'center', color: '#00ff00', marginBottom: '20px' }}>
                                    ✓ SYSTEM INITIALIZED - Ready for encryption
                                </p>
                                
                                <div style={{ textAlign: 'center', padding: '40px' }}>
                                    <h2 style={{ color: '#00ffff', marginBottom: '20px' }}>
                                        {'>'} UPLOAD IMAGE TO ENCRYPT
                                    </h2>
                                    <input
                                        type="file"
                                        accept="image/*"
                                        onChange={handleImageUpload}
                                        style={{ display: 'none' }}
                                        id="imageUpload"
                                    />
                                    <label
                                        htmlFor="imageUpload"
                                        className="cyber-button"
                                        style={{
                                            display: 'inline-flex',
                                            alignItems: 'center',
                                            gap: '10px',
                                            color: '#00ffff',
                                            borderColor: '#00ffff'
                                        }}
                                    >
                                        <Upload />
                                        SELECT IMAGE
                                    </label>
                                    
                                    {originalImage && (
                                        <div style={{ marginTop: '30px' }}>
                                            <div style={{ marginBottom: '20px' }}>
                                                <label style={{ color: '#00ffff', display: 'block', marginBottom: '10px' }}>
                                                    ENCRYPTION ROUNDS: {rounds}
                                                </label>
                                                <input
                                                    type="range"
                                                    min="1"
                                                    max="10"
                                                    value={rounds}
                                                    onChange={(e) => setRounds(parseInt(e.target.value))}
                                                    style={{ width: '300px' }}
                                                />
                                            </div>
                                            
                                            <div style={{
                                                display: 'grid',
                                                gridTemplateColumns: 'repeat(auto-fit, minmax(250px, 1fr))',
                                                gap: '20px',
                                                marginTop: '30px'
                                            }}>
                                                <div>
                                                    <h3 style={{ color: '#00ffff', marginBottom: '10px' }}>ORIGINAL</h3>
                                                    <img src={originalImage} alt="Original" style={{ width: '100%', border: '2px solid #00ffff' }} />
                                                    <button
                                                        onClick={encryptImage}
                                                        disabled={loading}
                                                        className="cyber-button"
                                                        style={{
                                                            width: '100%',
                                                            marginTop: '10px',
                                                            color: '#ff00ff',
                                                            borderColor: '#ff00ff'
                                                        }}
                                                    >
                                                        <Lock /> {loading ? 'ENCRYPTING...' : 'ENCRYPT'}
                                                    </button>
                                                </div>
                                                
                                                {encryptedImage && (
                                                    <div>
                                                        <h3 style={{ color: '#ff00ff', marginBottom: '10px' }}>ENCRYPTED</h3>
                                                        <img src={encryptedImage} alt="Encrypted" style={{ width: '100%', border: '2px solid #ff00ff' }} />
                                                        <button
                                                            onClick={decryptImage}
                                                            disabled={loading}
                                                            className="cyber-button"
                                                            style={{
                                                                width: '100%',
                                                                marginTop: '10px',
                                                                color: '#ffff00',
                                                                borderColor: '#ffff00'
                                                            }}
                                                        >
                                                            <Unlock /> {loading ? 'DECRYPTING...' : 'DECRYPT'}
                                                        </button>
                                                    </div>
                                                )}
                                                
                                                {decryptedImage && (
                                                    <div>
                                                        <h3 style={{ color: '#00ff00', marginBottom: '10px' }}>DECRYPTED</h3>
                                                        <img src={decryptedImage} alt="Decrypted" style={{ width: '100%', border: '2px solid #00ff00' }} />
                                                    </div>
                                                )}
                                            </div>
                                        </div>
                                    )}
                                    
                                    {visualData && (
                                        <div style={{ marginTop: '50px' }}>
                                            <h3 style={{ color: '#00ffff', marginBottom: '20px' }}>
                                                {'>'} PHASE SPACE TRAJECTORIES
                                            </h3>
                                            <canvas
                                                ref={canvasRef}
                                                width={1000}
                                                height={300}
                                                style={{ width: '100%', border: '2px solid #00ffff', background: '#000' }}
                                            />
                                            <div style={{ marginTop: '10px', display: 'flex', gap: '20px', justifyContent: 'center' }}>
                                                <span style={{ color: '#00ffff' }}>■ Rössler</span>
                                                <span style={{ color: '#ff00ff' }}>■ Chen</span>
                                                <span style={{ color: '#ffff00' }}>■ Lorenz</span>
                                            </div>
                                        </div>
                                    )}
                                </div>
                            </div>
                        )}
                    </div>
                </div>
            );
        }
        
        ReactDOM.render(<ChaoticCryptoApp />, document.getElementById('root'));
    </script>
</body>
</html>
